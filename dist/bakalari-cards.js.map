{"version":3,"file":"bakalari-cards.js","sources":["../src/cards/bakalari-base.ts","../src/cards/bakalari-messages.ts","../src/cards/bakalari-grades.ts","../src/cards/bakalari-timetable.ts","../src/cards/bakalari-overview.ts"],"sourcesContent":["export const CARD_VERSION = \"0.0.1\";\n\nexport function createCardHeader(title: string) {\n  const h = document.createElement(\"h3\");\n  h.textContent = title;\n  h.style.margin = \"0.5em 0\";\n  return h;\n}\n\nexport function registerCard(type: string, name: string, description: string) {\n  // @ts-ignore\n  const w = window as any;\n  w.customCards = w.customCards || [];\n  if (!w.customCards.some((c: any) => c?.type === type)) {\n    w.customCards.push({ type, name, description, preview: false });\n  }\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { createCardHeader } from \"./bakalari-base\";\nimport { registerCard } from \"./bakalari-base\";\n\nclass BakalariMessages extends HTMLElement {\n  static getStubConfig() {\n    return { entity: \"sensor.bakalari_zpravy\", title: \"üì¨ Zpr√°vy\" };\n  }\n\n  private _root: ShadowRoot | null = null;\n  private _hass: any = null;\n  private _stateObj: any = null;\n  private _config: any = {\n    title: \"üì¨ Zpr√°vy z Bakal√°≈ô≈Ø\",\n    limit: 100,\n    sort: \"desc\",\n    show_search: true,\n    show_only_unread: false,\n    allow_html: true,\n  };\n  private _open = new Set<string>();\n  private _query = \"\";\n  private _onlyUnread = false;\n\n  connectedCallback() {\n    const saved = this._loadBool(this._storageKey(\"only_unread\"), this._config.show_only_unread);\n    this._onlyUnread = saved;\n    this._ensureRoot();\n    this._render();\n  }\n\n  public setConfig(config: any) {\n    if (!config || !config.entity) throw new Error(\"bakalari-messages-card: 'entity' je povinn√©\");\n    this._config = Object.assign({}, this._config, config);\n    this._onlyUnread = !!this._config.show_only_unread;\n    this._render();\n  }\n\n  public set hass(hass: any) {\n    this._hass = hass;\n    this._stateObj = hass.states?.[this._config.entity];\n    this._render();\n  }\n\n  public getCardSize() {\n    return 3;\n  }\n\n  /* ------------ infra ------------ */\n  private _ensureRoot() {\n    if (this._root) return;\n    this._root = this.attachShadow({ mode: \"open\" });\n\n    this._root.innerHTML = `\n      <style>\n        :host { display:block; }\n        ha-card { display:block; }\n        .wrap { padding: 12px 16px; }\n        .header { display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; }\n        .title { font-weight:600; font-size:1.1rem; display:flex; align-items:center; gap:.5rem; }\n        .tools { display:flex; gap:8px; align-items:center; }\n        input.search {\n          min-width:200px; border:1px solid var(--divider-color);\n          background: var(--card-background-color); color: var(--primary-text-color);\n          border-radius:8px; padding:6px 8px;\n        }\n        .list { display:flex; flex-direction:column; gap:8px; }\n        .item { border:1px solid var(--divider-color); border-radius:12px; overflow:hidden; background: var(--card-background-color); }\n        .row { display:flex; gap:10px; align-items:center; padding:10px 12px; cursor:pointer; }\n        .bullet { width:8px; height:8px; border-radius:50%; background: var(--accent-color); opacity:.6; }\n        .meta { display:flex; flex-direction:column; gap:2px; flex:1; min-width:0; }\n        .titleline { font-weight:600; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }\n        .subline { color: var(--secondary-text-color); font-size:.9rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }\n        .date { color: var(--secondary-text-color); font-size:.85rem; }\n        .body { padding:0 12px 12px 12px; display:none; }\n        .item.open .body { display:block; }\n        .attachments { margin-top:6px; }\n        .attachments a { text-decoration:none; }\n        .empty { color: var(--secondary-text-color); padding:8px 0; }\n        .unreadOff .bullet { display:none; }\n        .tag { font-size:.75rem; padding:2px 6px; border-radius:999px; border:1px solid var(--divider-color); color: var(--secondary-text-color); }\n        .controls { display:flex; align-items:center; gap:10px; }\n        .switch { display:flex; align-items:center; gap:6px; font-size:.9rem; color: var(--secondary-text-color); }\n      </style>\n      <ha-card>\n        <div class=\"wrap\">\n          <div class=\"header\">\n            <div class=\"title\"></div>\n            <div class=\"tools\">\n              <div class=\"controls\">\n                <label class=\"switch\">\n                  <input type=\"checkbox\" id=\"onlyUnread\">\n                  <span>Jen nep≈ôeƒçten√©</span>\n                </label>\n              </div>\n              <input class=\"search\" id=\"search\" placeholder=\"Hledat ve zpr√°v√°ch\">\n            </div>\n          </div>\n          <div id=\"body\"></div>\n        </div>\n      </ha-card>\n    `;\n\n    // Delegated listener ‚Äì toggle body\n    this._root.addEventListener(\"click\", (e: Event) => {\n      // @ts-ignore\n      const path: Element[] = e.composedPath ? e.composedPath() : [];\n      const row = path.find((el: any) => el?.classList?.contains?.(\"row\"));\n      if (!row) return;\n      const item = (row as HTMLElement).closest(\".item\") as HTMLElement | null;\n      if (!item) return;\n      this._toggle(item.dataset.id || \"\");\n    });\n\n    // Search / switch\n    this._root.getElementById(\"search\")?.addEventListener(\"input\", (e: any) => {\n      this._query = e.target?.value || \"\";\n      this._renderBody();\n    });\n    this._root.getElementById(\"onlyUnread\")?.addEventListener(\"change\", (e: any) => {\n      this._onlyUnread = !!e.target?.checked;\n      this._saveBool(this._storageKey(\"only_unread\"), this._onlyUnread);\n      this._renderBody();\n    });\n  }\n\n  /* ------------ utils ------------ */\n  private _storageKey(suffix: string) {\n    const ent = (this._config?.entity || \"unknown\").replace(/\\W+/g, \"_\");\n    return `bakalari_messages_${ent}_${suffix}`;\n  }\n  private _loadBool(key: string, fallback = false) {\n    try {\n      const v = localStorage.getItem(key);\n      if (v === null) return fallback;\n      return v === \"1\";\n    } catch {\n      return fallback;\n    }\n  }\n  private _saveBool(key: string, value: boolean) {\n    try {\n      localStorage.setItem(key, value ? \"1\" : \"0\");\n    } catch {\n      // no-op\n    }\n  }\n\n  private _fmtDate(d: any) {\n    if (!d) return \"\";\n    try {\n      const date = typeof d === \"string\" || typeof d === \"number\" ? new Date(d) : d;\n      return date.toLocaleString(undefined, {\n        year: \"numeric\",\n        month: \"2-digit\",\n        day: \"2-digit\",\n        hour: \"2-digit\",\n        minute: \"2-digit\",\n      });\n    } catch {\n      return String(d);\n    }\n  }\n  private _escape(s: any) {\n    return String(s ?? \"\")\n      .replace(/&/g, \"&amp;\")\n      .replace(/</g, \"&lt;\")\n      .replace(/>/g, \"&gt;\");\n  }\n  private _linkify(text: string) {\n    const esc = this._escape(text).replace(/\\n/g, \"<br>\");\n    return esc.replace(/\\b(https?:\\/\\/[^\\s<]+)/g, (m) => {\n      return `<a href=\"${m}\" target=\"_blank\" rel=\"noopener noreferrer\">${m}</a>`;\n    });\n  }\n  private _filtered(messages: any[]) {\n    let arr = Array.isArray(messages) ? messages.slice() : [];\n    if (this._query) {\n      const q = this._query.toLowerCase();\n      arr = arr.filter(\n        (m) =>\n          (m.title || \"\").toLowerCase().includes(q) ||\n          (m.sender || \"\").toLowerCase().includes(q) ||\n          (m.text || \"\").toLowerCase().includes(q),\n      );\n    }\n    if (this._onlyUnread) arr = arr.filter((m) => m.unread === true);\n    const asc = (this._config.sort || \"desc\").toLowerCase() === \"asc\";\n    arr.sort((a, b) => new Date(a.sent || 0).getTime() - new Date(b.sent || 0).getTime());\n    if (!asc) arr.reverse();\n    const limit = Number(this._config.limit || 0);\n    if (limit > 0) arr = arr.slice(0, limit);\n    return arr;\n  }\n  private _toggle(id: string) {\n    if (!id) return;\n    if (this._open.has(id)) this._open.delete(id);\n    else this._open.add(id);\n    this._renderBody();\n  }\n\n  private _allowedUrl(href: string) {\n    try {\n      const u = new URL(href, window.location.href);\n      return u.protocol === \"http:\" || u.protocol === \"https:\";\n    } catch {\n      return false;\n    }\n  }\n\n  private _sanitize(html: any) {\n    // Safe reconstruction of allowed tags only\n    const allowedTags = new Set([\n      \"B\",\n      \"STRONG\",\n      \"I\",\n      \"EM\",\n      \"U\",\n      \"BR\",\n      \"P\",\n      \"UL\",\n      \"OL\",\n      \"LI\",\n      \"CODE\",\n      \"PRE\",\n      \"A\",\n    ]);\n    const doc = new DOMParser().parseFromString(String(html ?? \"\"), \"text/html\");\n    const out: string[] = [];\n\n    const walk = (node: any) => {\n      if (node.nodeType === Node.TEXT_NODE) {\n        out.push(this._escape(node.nodeValue));\n        return;\n      }\n      if (node.nodeType !== Node.ELEMENT_NODE) return;\n\n      const tag = node.tagName;\n      if (!allowedTags.has(tag)) {\n        node.childNodes.forEach(walk);\n        return;\n      }\n\n      if (tag === \"A\") {\n        const href = node.getAttribute(\"href\") || \"\";\n        if (!this._allowedUrl(href)) {\n          node.childNodes.forEach(walk);\n          return;\n        }\n        out.push(`<a href=\"${this._escape(href)}\" target=\"_blank\" rel=\"noopener noreferrer\">`);\n        node.childNodes.forEach(walk);\n        out.push(`</a>`);\n        return;\n      }\n\n      if (tag === \"BR\") {\n        out.push(\"<br>\");\n        return;\n      }\n\n      out.push(`<${tag.toLowerCase()}>`);\n      node.childNodes.forEach(walk);\n      out.push(`</${tag.toLowerCase()}>`);\n    };\n\n    doc.body.childNodes.forEach(walk);\n    return out.join(\"\");\n  }\n\n  /* ------------ render ------------ */\n  private _render() {\n    if (!this._root) return;\n    // title s mal√Ωm badge verze (createCardHeader dƒõl√° (vX.Y.Z))\n    const header = this._root.querySelector(\".title\");\n    if (header) {\n      header.innerHTML = \"\";\n      header.appendChild(createCardHeader(this._config.title || \"üì¨ Zpr√°vy\"));\n    }\n    const chk = this._root.getElementById(\"onlyUnread\") as HTMLInputElement | null;\n    if (chk) chk.checked = this._onlyUnread;\n    this._renderBody();\n  }\n\n  private _renderBody() {\n    if (!this._root) return;\n    const container = this._root.getElementById(\"body\");\n    const state = this._stateObj;\n\n    if (!state) {\n      container!.innerHTML = `<div class=\"empty\">Entita <b>${this._config.entity}</b> neexistuje.</div>`;\n      return;\n    }\n    const messages = state.attributes?.messages || [];\n    if (!Array.isArray(messages)) {\n      container!.innerHTML = `<div class=\"empty\">Atribut <code>messages</code> nen√≠ pole.</div>`;\n      return;\n    }\n\n    const list = this._filtered(messages);\n    if (!list.length) {\n      container!.innerHTML = `<div class=\"empty\">≈Ω√°dn√© zpr√°vy k zobrazen√≠.</div>`;\n      return;\n    }\n\n    const unreadClass = list.some((m: any) => m.unread) ? \"\" : \"unreadOff\";\n    const html = [\n      `<div class=\"list ${unreadClass}\">`,\n      ...list.map((m: any, idx: number) => {\n        const id = `${idx}-${m.sent ?? \"\"}-${m.title ?? \"\"}`.replace(/\\s+/g, \"_\");\n        const open = this._open.has(id) ? \" open\" : \"\";\n        const attachments = Array.isArray(m.attachments) ? m.attachments : [];\n\n        const textHtml = this._config.allow_html\n          ? this._sanitize(m.html ?? m.text ?? \"\")\n          : this._linkify(m.text || \"\");\n\n        return `\n          <div class=\"item${open}\" data-id=\"${id}\">\n            <div class=\"row\">\n              <div class=\"bullet\" style=\"${m.unread ? \"\" : \"opacity:0.15;\"}\"></div>\n              <div class=\"meta\">\n                <div class=\"titleline\">${this._escape(m.title || \"Bez p≈ôedmƒõtu\")}</div>\n                <div class=\"subline\">${this._escape(m.sender || \"Nezn√°m√Ω odes√≠latel\")}</div>\n              </div>\n              <div class=\"date\">${this._fmtDate(m.sent)}</div>\n            </div>\n            <div class=\"body\">\n              <div class=\"text\">${textHtml}</div>\n              ${\n                attachments.length\n                  ? `<div class=\"attachments\">\n                     <span class=\"tag\">P≈ô√≠lohy</span>\n                     <ul>\n                       ${attachments\n                         .map(\n                           (a: any) => `\n                         <li><a href=\"${a.url}\" target=\"_blank\" rel=\"noopener noreferrer\">${this._escape(a.name || a.url)}</a></li>\n                       `,\n                         )\n                         .join(\"\")}\n                     </ul>\n                   </div>`\n                  : \"\"\n              }\n            </div>\n          </div>`;\n      }),\n      `</div>`,\n    ].join(\"\");\n\n    container!.innerHTML = html;\n  }\n}\n\nif (!customElements.get(\"bakalari-messages-card\")) {\n  customElements.define(\"bakalari-messages-card\", BakalariMessages);\n}\n\nregisterCard(\n  \"bakalari-messages-card\",\n  \"üì¨ Bakal√°≈ôi ‚Äì Zpr√°vy\",\n  \"P≈ôehledn√° karta pro zpr√°vy z Bakal√°≈ô≈Ø (klikac√≠, vyhled√°v√°n√≠, p≈ô√≠lohy).\",\n);\n","import { createCardHeader } from \"./bakalari-base\";\nimport { registerCard } from \"./bakalari-base\";\n\nclass BakalariGradesCard extends HTMLElement {\n  private _config: any;\n  setConfig(config: any) {\n    this._config = config;\n  }\n  set hass(_hass: any) {\n    this.innerHTML = \"\";\n    this.appendChild(createCardHeader(\"Bakal√°≈ôi ‚Äì zn√°mky\"));\n    const p = document.createElement(\"p\");\n    p.textContent = \"Zde budou data o zn√°mk√°ch.\";\n    this.appendChild(p);\n  }\n  getCardSize() {\n    return 3;\n  }\n}\ncustomElements.define(\"bakalari-grades-card\", BakalariGradesCard);\nregisterCard(\"bakalari-grades-card\", \"Bakal√°≈ôi - zn√°mky\", \"Karta pro zobrazen√≠ zn√°mek\");\n","import { createCardHeader } from \"./bakalari-base\";\nimport { registerCard } from \"./bakalari-base\";\n\nclass BakalariTimetableCard extends HTMLElement {\n  private _config: any;\n  setConfig(config: any) {\n    this._config = config;\n  }\n  set hass(_hass: any) {\n    this.innerHTML = \"\";\n    this.appendChild(createCardHeader(\"Bakal√°≈ôi ‚Äì rozvrh\"));\n    const p = document.createElement(\"p\");\n    p.textContent = \"Zde bude rozvrh.\";\n    this.appendChild(p);\n  }\n  getCardSize() {\n    return 3;\n  }\n}\ncustomElements.define(\"bakalari-timetable-card\", BakalariTimetableCard);\nregisterCard(\"bakalari-timetable-card\", \"Bakal√°≈ôi - rozvrh hodin\", \"Zobrazen√≠ rozvrhu hodin\");\n","import { createCardHeader } from \"./bakalari-base\";\n\nclass BakalariOverviewCard extends HTMLElement {\n  private _config: any;\n  setConfig(config: any) { this._config = config; }\n  set hass(_hass: any) {\n    this.innerHTML = \"\";\n    this.appendChild(createCardHeader(\"Bakal√°≈ôi ‚Äì p≈ôehled\"));\n    const p = document.createElement(\"p\");\n    p.textContent = \"Souhrnn√Ω p≈ôehled Bakal√°≈ô≈Ø.\";\n    this.appendChild(p);\n  }\n  getCardSize() { return 3; }\n}\ncustomElements.define(\"bakalari-overview-card\", BakalariOverviewCard);\n"],"names":["createCardHeader","title","h","registerCard","type","name","description","w","c","BakalariMessages","saved","config","hass","_a","_b","e","row","el","item","suffix","key","fallback","v","value","d","s","text","m","messages","arr","q","asc","a","b","limit","id","href","u","html","allowedTags","doc","out","walk","node","tag","header","chk","container","state","list","idx","open","attachments","textHtml","BakalariGradesCard","_hass","p","BakalariTimetableCard","BakalariOverviewCard"],"mappings":"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"}